<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Methankrieg â€“ KontextmenÃ¼ Test</title>

  <!-- âœ… Zentrale CSS-Datei fÃ¼r Hex-Stile und Cursor -->
  <link rel="stylesheet" href="karte.css">

  <!-- âœ… Zoom-Tool (Panzoom) -->
  <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: white;
      font-family: sans-serif;
    }
    #container {
      width: 100%;
      height: calc(100% - 30px);
    }
    #svgwrapper {
      width: 100%;
      height: 100%;
    }
    svg {
      width: 100%;
      height: 100%;
    }
    #log {
      height: 30px;
      line-height: 30px;
      background: #eee;
      border-top: 1px solid #ccc;
      padding-left: 10px;
      font-size: 14px;
    }
    .selected {
      stroke: orange;
      stroke-width: 3;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="svgwrapper"></div>
  </div>
  <div id="log">[DEBUG] System bereit.</div>

  <!-- âœ… Detail-Panel fÃ¼r Systeminformationen -->
  <div id="detailpanel-container" style="
    position: absolute;
    top: 0;
    right: 0;
    width: 320px;
    height: 100%;
    background: white;
    border-left: 1px solid #ccc;
    display: none;
    z-index: 2000;
    box-shadow: -2px 0 5px rgba(0,0,0,0.2);">
    <button onclick="document.getElementById('detailpanel-container').style.display='none'"
            style="position:absolute; top:10px; right:10px; z-index:2100;">
      âœ–
    </button>
    <iframe id="detailpanel-frame" src="" style="width: 100%; height: 100%; border: none;"></iframe>
  </div>

  <!-- 1ï¸âƒ£ Spiellogik und ZustÃ¤nde -->
  <script src="gameState.js"></script>
  <script src="lade_datenbanken.js"></script>

  <!-- 2ï¸âƒ£ Kartenlade-Logik -->
  <script src="kartenloader.js"></script>

  <!-- 3ï¸âƒ£ Logikmodule -->
  <script src="bewegungslogik.js"></script>
  <script src="marker_movement.js"></script>

  <!-- 4ï¸âƒ£ MenÃ¼- und UI-Funktionen -->
  <script src="kontextmenu_v5_komplett.js"></script>

  <!-- 5ï¸âƒ£ Aktionen im KontextmenÃ¼ -->
  <script src="kontextaktionen.js"></script>

  <!-- 6ï¸âƒ£ Visuelle Hexfeld-Stile aktualisieren -->
  <script src="aktualisiereHexfeldStile.js"></script>

  <!-- 7ï¸âƒ£ Sprungrouten anzeigen -->
  <script src="sprungrouten_anzeige.js"></script>

  <!-- ðŸ§  Initialisierung: DOM fertig geladen -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      await ladeDatenbanken(); // âœ… JSON-Datenbanken laden

      const svg = await ladeKarte("Karte_Sektor_F_v1.svg", "svgwrapper"); // âœ… SVG-Karte laden

      if (svg) {
        initialisiereKontextmenu(svg); // âœ… KontextmenÃ¼ initialisieren

        // âœ… Hexfeld-Stile anwenden (z.â€¯B. Dunkelwolken, Navigation, Systeme)
        if (typeof aktualisiereHexfeldStile === "function") {
          aktualisiereHexfeldStile(svg);
        }

        // âœ… Sprungrouten anzeigen
        if (typeof zeichneSprungrouten === "function" && typeof sprungrouten_datenbank !== "undefined") {
          zeichneSprungrouten(svg, sprungrouten_datenbank);
        }
      }

      console.log("[INIT] Karte, MenÃ¼, Stile und Sprungrouten initialisiert.");
    });
  </script>
</body>
</html>
