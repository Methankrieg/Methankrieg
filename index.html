
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Methankrieg Interaktive Karte – Fixierte Polygoninitialisierung</title>
  <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: white;
      font-family: sans-serif;
    }
    #container {
      width: 100%;
      height: calc(100% - 30px);
      background: white;
    }
    #svgwrapper {
      width: 100%;
      height: 100%;
    }
    #tooltip {
      position: absolute;
      background: #222;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      display: none;
      z-index: 1000;
    }
    #contextmenu {
      position: absolute;
      background: #fff;
      border: 1px solid #666;
      padding: 6px;
      display: none;
      z-index: 1001;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.4);
    }
    #log {
      height: 30px;
      line-height: 30px;
      background: #eee;
      border-top: 1px solid #ccc;
      padding-left: 10px;
      font-size: 14px;
    }
    .selected {
      stroke: orange;
      stroke-width: 3;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="svgwrapper"></div>
  </div>
  <div id="tooltip"></div>
  <div id="contextmenu"></div>
  <div id="log">[DEBUG] System bereit.</div>

  <script>
    const wrapper = document.getElementById("svgwrapper");
    const tooltip = document.getElementById("tooltip");
    const contextmenu = document.getElementById("contextmenu");
    const log = document.getElementById("log");

    let selectedHex = null;

    fetch("Sektor_TEMPLATE_PERFEKT_LayerFix_mitHintergrund.svg")
      .then(response => response.text())
      .then(data => {
        wrapper.innerHTML = data;

        requestAnimationFrame(() => {
          const svg = wrapper.querySelector("svg");

          if (!svg) {
            log.textContent = "[FEHLER] SVG nicht korrekt geladen.";
            return;
          }

          // Panzoom aktivieren
          const panzoom = Panzoom(svg, {
            contain: 'outside',
            maxScale: 5,
            minScale: 0.2,
            startScale: 0.5
          });
          wrapper.addEventListener('wheel', panzoom.zoomWithWheel);

          const polygons = svg.querySelectorAll("#Hex_grid_02 polygon");

          if (polygons.length === 0) {
            log.textContent = "[FEHLER] Keine Polygone gefunden (Layer Hex_grid_02 leer?)";
            return;
          }

          polygons.forEach(poly => {
            poly.style.cursor = "pointer";

            poly.addEventListener("click", (e) => {
              e.stopPropagation();
              e.preventDefault();
              if (selectedHex) selectedHex.classList.remove("selected");
              selectedHex = poly;
              poly.classList.add("selected");
              log.textContent = "[DEBUG] Hexfeld ausgewählt: " + poly.id;
              contextmenu.style.display = "none";
            });

            poly.addEventListener("contextmenu", (e) => {
              e.preventDefault();
              contextmenu.innerHTML = "<strong>Kontextmenü für:</strong><br>" + poly.id + "<br>(Layerdaten folgen)";
              contextmenu.style.left = e.pageX + "px";
              contextmenu.style.top = e.pageY + "px";
              contextmenu.style.display = "block";
              log.textContent = "[DEBUG] Rechtsklick auf: " + poly.id;
            });
          });

          document.addEventListener("click", () => {
            contextmenu.style.display = "none";
          });
        });
      })
      .catch(err => {
        log.textContent = "[FEHLER] SVG konnte nicht geladen werden: " + err;
      });
  </script>
</body>
</html>
